<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Sreedhar Chikatla</title>
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <script src="https://alcdn.msauth.net/browser/2.14.1/js/msal-browser.min.js"></script>
</head>
<body>
    <header>
        <h1>Welcome to Your Dashboard</h1>
        <p id="welcome-message">Loading...</p>
        <nav>
            <ul>
                <li><a href="#" onclick="viewProfile()">View Profile</a></li>
                <li><a href="#" onclick="editProfile()">Account Settings</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </nav>
    </header>

    <script>
        // MSAL Configuration for Redirect URI
        const msalConfig = {
            auth: {
                clientId: '3b68b2c1-7a19-4ef2-93ff-a7fea2cd5f0c',
                authority: 'https://sreedharchikatla.b2clogin.com/sreedharchikatla.onmicrosoft.com/B2C_1_signupsignin',
                knownAuthorities: ['sreedharchikatla.b2clogin.com'],
                redirectUri: 'https://www.sreedharchikatla.xyz/dashboard.html'
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        // Handle Redirect Response and Load Dashboard
        document.addEventListener("DOMContentLoaded", () => {
            msalInstance.handleRedirectPromise()
                .then((response) => {
                    if (response !== null && response.account) {
                        console.log("Login successful!", response.account);
                        sessionStorage.setItem("user", JSON.stringify(response.account));
                        document.getElementById("welcome-message").innerText = `Hello, ${response.account.username}`;
                    } else {
                        // No session, redirect to login
                        console.log("No active session detected. Redirecting to login...");
                        window.location.href = "/login.html";
                    }
                })
                .catch((error) => {
                    console.error("Error handling redirect:", error);
                    window.location.href = "/login.html"; // Fallback to login
                });
        });

        // Profile Editing Flow
        function editProfile() {
            msalInstance.loginRedirect({
                authority: 'https://sreedharchikatla.b2clogin.com/sreedharchikatla.onmicrosoft.com/B2C_1_profileediting',
                scopes: ["openid"]
            });
        }

        // Logout
        function logout() {
            msalInstance.logoutRedirect({
                postLogoutRedirectUri: 'https://www.sreedharchikatla.xyz'
            });
        }
    </script>
</body>
</html>
