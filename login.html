<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Sreedhar Chikatla</title>
    <script src="https://alcdn.msauth.net/browser/2.14.1/js/msal-browser.min.js"></script>
</head>
<body>

    <div class="login-container">
        <h2>Login</h2>
        <p>Please wait while we log you in...</p>
        <button type="button" onclick="login()">Login with Azure B2C</button>
        <button type="button" onclick="resetPassword()">Forgot Password?</button>
    </div>

    <script>
        const msalConfig = {
            auth: {
                clientId: '3b68b2c1-7a19-4ef2-93ff-a7fea2cd5f0c', // Application ID
                authority: 'https://sreedharchikatla.b2clogin.com/sreedharchikatla.onmicrosoft.com/B2C_1_signupsignin',
                knownAuthorities: ['sreedharchikatla.b2clogin.com'],
                redirectUri: 'https://www.sreedharchikatla.xyz'
            }
        };

        const passwordResetAuthority = "https://sreedharchikatla.b2clogin.com/sreedharchikatla.onmicrosoft.com/B2C_1_passwordreset";

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        // Function to trigger Azure B2C login
        function login() {
            msalInstance.loginRedirect({
                scopes: ["openid"],
                prompt: "login"
            });
        }

        // Function to trigger Password Reset User Flow
        function resetPassword() {
            msalInstance.loginRedirect({
                authority: passwordResetAuthority,
                scopes: ["openid"]
            });
        }

        // Handle the redirect response
        msalInstance.handleRedirectPromise()
            .then((response) => {
                if (response !== null && response.account) {
                    console.log("Login successful!", response.account);
                    alert(`Welcome, ${response.account.username}!`);
                    window.location.href = "/dashboard.html";
                }
            })
            .catch((error) => {
                if (error.errorMessage && error.errorMessage.indexOf("AADB2C90118") > -1) {
                    // Trigger Password Reset flow if error AADB2C90118 is returned
                    console.warn("User clicked 'Forgot Password'. Redirecting to Password Reset...");
                    resetPassword();
                } else {
                    console.error("Error during login redirect:", error);
                }
            });

        // Automatically trigger login on page load
        window.onload = login;
    </script>

</body>
</html>
