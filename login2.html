<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Sreedhar Chikatla</title>
    <link rel="stylesheet" href="assets/css/login.css">
    <script src="https://alcdn.msauth.net/browser/2.14.1/js/msal-browser.min.js"></script>
</head>
<body>
    <div class="login-container">
        <h2>Login Page</h2>
        <!-- Placeholder Username/Password -->
        <form>
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter Username">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter Password">
            <button type="button" onclick="alert('Manual login not implemented')">Login</button>
        </form>

        <hr>
        <!-- Azure B2C Buttons -->
        <button id="b2c-login" onclick="loginWithB2C()">Login with Azure B2C</button>
        <button id="reset-password" onclick="resetPassword()">Forgot Password</button>
    </div>

    <script>
        // Azure B2C Configuration for Login Flow
        const loginConfig = {
            auth: {
                clientId: '3b68b2c1-7a19-4ef2-93ff-a7fea2cd5f0c',
                authority: 'https://sreedharchikatla.b2clogin.com/sreedharchikatla.onmicrosoft.com/B2C_1_signupsignin',
                knownAuthorities: ['sreedharchikatla.b2clogin.com'],
                redirectUri: 'https://www.sreedharchikatla.xyz/dashboard.html'
            }
        };

        // Azure B2C Configuration for Password Reset Flow
        const resetConfig = {
            auth: {
                clientId: '3b68b2c1-7a19-4ef2-93ff-a7fea2cd5f0c',
                authority: 'https://sreedharchikatla.b2clogin.com/sreedharchikatla.onmicrosoft.com/B2C_1_passwordreset',
                knownAuthorities: ['sreedharchikatla.b2clogin.com'],
                redirectUri: 'https://www.sreedharchikatla.xyz/login.html'
            }
        };

        // Separate MSAL Instances
        const loginInstance = new msal.PublicClientApplication(loginConfig);
        const resetInstance = new msal.PublicClientApplication(resetConfig);

        // Trigger Login Flow
        function loginWithB2C() {
            console.log("Redirecting to Azure B2C Sign-in...");
            loginInstance.loginRedirect({
                scopes: ["openid"],
                prompt: "login"
            });
        }

        // Trigger Password Reset Flow
        function resetPassword() {
            console.log("Redirecting to Password Reset...");
            resetInstance.loginRedirect({
                scopes: ["openid"],
                prompt: "login"
            });
        }

        // Handle Redirect Responses
        loginInstance.handleRedirectPromise()
            .then((response) => {
                if (response && response.account) {
                    console.log("Login successful:", response.account);
                    sessionStorage.setItem("user", JSON.stringify(response.account));
                    window.location.href = "/dashboard.html";
                }
            })
            .catch((error) => {
                console.error("Error during login flow:", error);
            });

        resetInstance.handleRedirectPromise()
            .then(() => {
                console.log("Password reset completed. Returning to login page...");
                window.location.href = "/login.html"; // Redirect after reset
            })
            .catch((error) => {
                console.error("Error during password reset flow:", error);
            });
    </script>
</body>
</html>
